<img id='imageid' src='./logo11w.png' />
<button type="button" onclick="getBase64Image()">Click Me!</button>
<script src='./canvas-toBlob.js'></script>
<script>
function getBase64Image()
{
   var img = document.getElementById("imageid")
   var canvas = document.createElement("canvas");
   canvas.width = img.width;
   canvas.height = img.height;
   var ctx = canvas.getContext("2d");
   ctx.drawImage(img, 0, 0);
   //var dataURL = canvas.toDataURL("image/png");
   //console.log(dataURL);
   //return dataURL.replace(/^data:image\/(png|jpg);base64,/, "");

   canvas.toBlob(blob =>
   {
      //window.location.href = URL.createObjectURL(blob)
      /*
      let downloader	= document.createElement('a');
      downloader.download = `${new Date().getTime()}.png`;
      downloader.href = URL.createObjectURL(blob)
      downloader.click();
      */
      
      var reader = new FileReader();
      reader.onloadend = function() {
         var base64Data = reader.result;
         //window.open(`data:attachment/file${base64Data.slice(base64Data.search(/[,;]/))}`)
         //window.location.href = URL.createObjectURL(blob)

         var a = document.createElement('a');
         a.setAttribute("href", `data:attachment/file${base64Data.slice(base64Data.search(/[,;]/))}`);
         a.setAttribute('download', `${new Date().getTime()}.png`);
         a.click()
         //a.setAttribute("target", "_blank");
         //var dispatch = document.createEvent("HTMLEvents");
         //dispatch.initEvent("click", true, true);
         //a.dispatchEvent(dispatch);
         //return false;

         //let downloader	= document.createElement('a');
         //downloader.download = `${new Date().getTime()}.png`;
         //downloader.href = 'data:attachment/image' + base64Data.slice(base64Data.search(/[,;]/))
         //downloader.click();

      };
      reader.readAsDataURL(blob);
      
   }, 'image/png');
}

window.onload = _ =>
{
   var div = document.createElement("div");
   div.innerText = navigator.userAgent
   document.body.appendChild(div)
   console.log(div)

   //var base64 = getBase64Image(document.getElementById("imageid"));
   //console.log(base64);
}
</script>